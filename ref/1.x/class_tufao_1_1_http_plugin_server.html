<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>tufao: Tufao::HttpPluginServer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tufao_logo.svg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">tufao
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
   <div id="projectbrief">An asynchronous web framework for C++ built on top of Qt</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_tufao_1_1_http_plugin_server.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-slots">Public Slots</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_tufao_1_1_http_plugin_server-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Tufao::HttpPluginServer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class provides a plugin-based request handler.  
 <a href="class_tufao_1_1_http_plugin_server.html#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for Tufao::HttpPluginServer:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_tufao_1_1_http_plugin_server__inherit__graph.png" border="0" usemap="#_tufao_1_1_http_plugin_server_inherit__map" alt="Inheritance graph"/></div>
<map name="_tufao_1_1_http_plugin_server_inherit__map" id="_tufao_1_1_http_plugin_server_inherit__map">
<area shape="rect" id="node3" href="class_tufao_1_1_abstract_http_server_request_handler.html" title="This class provides an interface for HttpServerRequest handlers. " alt="" coords="100,5,299,156"/></map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for Tufao::HttpPluginServer:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_tufao_1_1_http_plugin_server__coll__graph.png" border="0" usemap="#_tufao_1_1_http_plugin_server_coll__map" alt="Collaboration graph"/></div>
<map name="_tufao_1_1_http_plugin_server_coll__map" id="_tufao_1_1_http_plugin_server_coll__map">
<area shape="rect" id="node3" href="class_tufao_1_1_abstract_http_server_request_handler.html" title="This class provides an interface for HttpServerRequest handlers. " alt="" coords="100,5,299,156"/></map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-slots"></a>
Public Slots</h2></td></tr>
<tr class="memitem:aefdcee9b855f96ef3a513354197d5e26"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_http_plugin_server.html#aefdcee9b855f96ef3a513354197d5e26">handleRequest</a> (<a class="el" href="class_tufao_1_1_http_server_request.html">Tufao::HttpServerRequest</a> &amp;request, <a class="el" href="class_tufao_1_1_http_server_response.html">Tufao::HttpServerResponse</a> &amp;response) override</td></tr>
<tr class="memdesc:aefdcee9b855f96ef3a513354197d5e26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle the request using the loaded plugins and rules.  <a href="#aefdcee9b855f96ef3a513354197d5e26">More...</a><br /></td></tr>
<tr class="separator:aefdcee9b855f96ef3a513354197d5e26"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab7ca537918a01440b7dc436a02b2b6c9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_http_plugin_server.html#ab7ca537918a01440b7dc436a02b2b6c9">HttpPluginServer</a> (QObject *parent=0)</td></tr>
<tr class="memdesc:ab7ca537918a01440b7dc436a02b2b6c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs a null <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> object.  <a href="#ab7ca537918a01440b7dc436a02b2b6c9">More...</a><br /></td></tr>
<tr class="separator:ab7ca537918a01440b7dc436a02b2b6c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af905a5c1d2690dcfd152d3c7b112469d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_http_plugin_server.html#af905a5c1d2690dcfd152d3c7b112469d">HttpPluginServer</a> (const QString &amp;configFile, QObject *parent=0)</td></tr>
<tr class="memdesc:af905a5c1d2690dcfd152d3c7b112469d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs a <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> object.  <a href="#af905a5c1d2690dcfd152d3c7b112469d">More...</a><br /></td></tr>
<tr class="separator:af905a5c1d2690dcfd152d3c7b112469d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f3bb3f91b42a8132bb03ffc3b209347"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0f3bb3f91b42a8132bb03ffc3b209347"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_http_plugin_server.html#a0f3bb3f91b42a8132bb03ffc3b209347">~HttpPluginServer</a> ()</td></tr>
<tr class="memdesc:a0f3bb3f91b42a8132bb03ffc3b209347"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroys the object. <br /></td></tr>
<tr class="separator:a0f3bb3f91b42a8132bb03ffc3b209347"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af75c908ca6ee10e923839cb7149ad600"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_http_plugin_server.html#af75c908ca6ee10e923839cb7149ad600">setConfig</a> (const QString &amp;file)</td></tr>
<tr class="memdesc:af75c908ca6ee10e923839cb7149ad600"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the configuration file used to handle requests.  <a href="#af75c908ca6ee10e923839cb7149ad600">More...</a><br /></td></tr>
<tr class="separator:af75c908ca6ee10e923839cb7149ad600"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c1c5e33bb60c966bb129d30b137aa8a"><td class="memItemLeft" align="right" valign="top">QString&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_http_plugin_server.html#a4c1c5e33bb60c966bb129d30b137aa8a">config</a> () const </td></tr>
<tr class="memdesc:a4c1c5e33bb60c966bb129d30b137aa8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the path of the last configuration file used.  <a href="#a4c1c5e33bb60c966bb129d30b137aa8a">More...</a><br /></td></tr>
<tr class="separator:a4c1c5e33bb60c966bb129d30b137aa8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_tufao_1_1_abstract_http_server_request_handler"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_tufao_1_1_abstract_http_server_request_handler')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html">Tufao::AbstractHttpServerRequestHandler</a></td></tr>
<tr class="memitem:aa1cc8e7e0e5c7f4c91eeed8542004177 inherit pub_methods_class_tufao_1_1_abstract_http_server_request_handler"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html#aa1cc8e7e0e5c7f4c91eeed8542004177">operator std::function&lt; bool</a> (<a class="el" href="class_tufao_1_1_http_server_request.html">HttpServerRequest</a> &amp;, <a class="el" href="class_tufao_1_1_http_server_response.html">HttpServerResponse</a> &amp;)&gt;()</td></tr>
<tr class="memdesc:aa1cc8e7e0e5c7f4c91eeed8542004177 inherit pub_methods_class_tufao_1_1_abstract_http_server_request_handler"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implicit conversion operator to std::function functor object.  <a href="#aa1cc8e7e0e5c7f4c91eeed8542004177">More...</a><br /></td></tr>
<tr class="separator:aa1cc8e7e0e5c7f4c91eeed8542004177 inherit pub_methods_class_tufao_1_1_abstract_http_server_request_handler"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0391acca2efe108644c9e7bc3575af8 inherit pub_methods_class_tufao_1_1_abstract_http_server_request_handler"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html#aa0391acca2efe108644c9e7bc3575af8">handleRequest</a> (<a class="el" href="class_tufao_1_1_http_server_request.html">Tufao::HttpServerRequest</a> &amp;request, <a class="el" href="class_tufao_1_1_http_server_response.html">Tufao::HttpServerResponse</a> &amp;response)=0</td></tr>
<tr class="memdesc:aa0391acca2efe108644c9e7bc3575af8 inherit pub_methods_class_tufao_1_1_abstract_http_server_request_handler"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the <code>request</code> using the <code>response</code> object.  <a href="#aa0391acca2efe108644c9e7bc3575af8">More...</a><br /></td></tr>
<tr class="separator:aa0391acca2efe108644c9e7bc3575af8 inherit pub_methods_class_tufao_1_1_abstract_http_server_request_handler"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class provides a plugin-based request handler. </p>
<p>Use it if you need to change the application code without restart the server.</p>
<p>It maintains its own set of rules and is as powerful as <a class="el" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router. ">HttpServerRequestRouter</a> (and internally uses it), but, in contrast, exports its configuration through a json file and will use handlers loaded from plugins.</p>
<p>The file format is described in the <a class="el" href="class_tufao_1_1_http_plugin_server.html#af75c908ca6ee10e923839cb7149ad600" title="Set the configuration file used to handle requests. ">HttpPluginServer::setConfig</a> method.</p>
<dl class="section note"><dt>Note</dt><dd>The object will monitor the config file for changes and reload it as changes happens.</dd></dl>
<dl class="section see"><dt>See also</dt><dd>AbstractHttpServerRequestHandlerFactory to implement your plugins.</dd>
<dd>
<a class="el" href="pluginsystem.html">Tufão's plugin system</a></dd></dl>
<dl class="section since"><dt>Since</dt><dd>0.3 </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ab7ca537918a01440b7dc436a02b2b6c9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Tufao::HttpPluginServer::HttpPluginServer </td>
          <td>(</td>
          <td class="paramtype">QObject *&#160;</td>
          <td class="paramname"><em>parent</em> = <code>0</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructs a null <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> object. </p>
<p><code>parent</code> is passed to the QObject constructor. </p>

</div>
</div>
<a class="anchor" id="af905a5c1d2690dcfd152d3c7b112469d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Tufao::HttpPluginServer::HttpPluginServer </td>
          <td>(</td>
          <td class="paramtype">const QString &amp;&#160;</td>
          <td class="paramname"><em>configFile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QObject *&#160;</td>
          <td class="paramname"><em>parent</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructs a <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> object. </p>
<p><code>parent</code> is passed to the QObject constructor.</p>
<p><code>configFile</code> is used as configuration file.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="class_tufao_1_1_http_plugin_server.html#af75c908ca6ee10e923839cb7149ad600" title="Set the configuration file used to handle requests. ">setConfig</a> </dd></dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a4c1c5e33bb60c966bb129d30b137aa8a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">QString Tufao::HttpPluginServer::config </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the path of the last configuration file used. </p>
<p>This file is used to handle requests, loading the appropriate plugins, generating actual handlers and mapping them to the rules described in this file.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="class_tufao_1_1_http_plugin_server.html#af75c908ca6ee10e923839cb7149ad600" title="Set the configuration file used to handle requests. ">setConfig</a> </dd></dl>

</div>
</div>
<a class="anchor" id="aefdcee9b855f96ef3a513354197d5e26"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Tufao::HttpPluginServer::handleRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_tufao_1_1_http_server_request.html">Tufao::HttpServerRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tufao_1_1_http_server_response.html">Tufao::HttpServerResponse</a> &amp;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">slot</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handle the request using the loaded plugins and rules. </p>
<dl class="section note"><dt>Note</dt><dd>In Tufão 0.x, handleRequest caught exceptions thrown by plugins, but in Tufão 1.0, this behaviour is not used anymore, because it was stealing the power and the control of the programmer.</dd></dl>
<dl class="section since"><dt>Since</dt><dd>1.0 </dd></dl>

</div>
</div>
<a class="anchor" id="af75c908ca6ee10e923839cb7149ad600"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Tufao::HttpPluginServer::setConfig </td>
          <td>(</td>
          <td class="paramtype">const QString &amp;&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the configuration file used to handle requests. </p>
<p>After the file is set, <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> will watch the file for changes and reload its config when the file changes.</p>
<dl class="section warning"><dt>Warning</dt><dd><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> can't monitor file links correctly.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The old config is cleared even if it fails to set the new config.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>if <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> finds the file. </td></tr>
    <tr><td class="paramname">false</td><td>if <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> can't find the file.</td></tr>
  </table>
  </dd>
</dl>
<p>Call this method with an empty string if you want to <em>clear</em> the plugin server.</p>
<h1>The <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> behaviour </h1>
<p>An simplified use case to describing how <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> reacts to changes follows:</p>
<ol type="1">
<li>You start with a default-constructed <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a></li>
<li>You use setConfig with an inexistent file<ol type="a">
<li>The <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> do not find the file</li>
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html#af75c908ca6ee10e923839cb7149ad600" title="Set the configuration file used to handle requests. ">HttpPluginServer::setConfig</a> returns false</li>
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> object remains in the previous state</li>
</ol>
</li>
<li>You use setConfig with a invalid file<ol type="a">
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> starts to monitor the config file</li>
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html#af75c908ca6ee10e923839cb7149ad600" title="Set the configuration file used to handle requests. ">HttpPluginServer::setConfig</a> returns true</li>
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> reads the invalid file and remains in the previous state.</li>
</ol>
</li>
<li>You fill the config file with a valid config.<ol type="a">
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> object load the new contents</li>
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> try to load every plugin and fill the router. If a plugin cannot be loaded, it will be skipped and a warning message is sent through qWarning. If you need to load this plugin, make any modification to the config file and <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> will try again.</li>
</ol>
</li>
<li>You fill the config file with an invalid config.<ol type="a">
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> see and ignores the changes, remaining with the previous settings.</li>
</ol>
</li>
<li>You remove the config file.<ol type="a">
<li><p class="startli"><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> object come back to the default-constructed state.</p>
<h2>version: 0</h2>
<p class="startli">If the last config had "version: 0", then it means no more monitoring either (this is what default-constructed state means).</p>
<h2>version: 1</h2>
<p class="startli">If the last config had "version: 1", then <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> will (after the cleanup) start to monitor the containing folder, waiting until a config file with the same name is available again to resume its operation.</p>
<dl class="section note"><dt>Note</dt><dd>A later call to <a class="el" href="class_tufao_1_1_http_plugin_server.html#af75c908ca6ee10e923839cb7149ad600" title="Set the configuration file used to handle requests. ">HttpPluginServer::setConfig</a> can be used to stop the monitoring.</dd></dl>
<p>&#160;</p>
<dl class="section note"><dt>Note</dt><dd>If the containing dir is also erased, <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> can do nothing and the monitoring will stop.</dd></dl>
<p>&#160;</p>
</li>
</ol>
</li>
</ol>
<h1>The file format </h1>
<p>The configuration file format is json-based. If you aren't used to JSON, read the <a href="http://json.org/">json specification</a>.</p>
<dl class="section note"><dt>Note</dt><dd>The old Tufão 0.x releases used a file with the syntax based on the QSettings ini format and forced you to use the <em>tufao-routes-editor</em> application to edit this file.</dd></dl>
<p>The file must have a root json object with 3 attributes:</p>
<ul>
<li><em>version</em>: It must indicate the version of the configuration file. The list of acceptable values are:<ul>
<li><em>0</em>: Version recognizable by Tufão 1.x, starting from 1.0</li>
<li><em>1</em>: Version recognizable by Tufão 1.x, starting from 1.2. The only difference is the autoreloading behaviour. If you delete the config file, Tufão will start to monitor the containing folder and resume the normal operation as soon as the file is added to the folder again.</li>
</ul>
</li>
<li><em>plugins</em>: This attribute stores metadata about the plugins. All plugins specified here will be loaded, even if they aren't used in the request router. The value of this field must be an array and each element of this array must be an object with the following attributes:<ul>
<li><em>name</em>: This is the name of the plugin and defines how you will refer to this plugin later. You can't have two plugins with the same name. This attribute is <b>required</b>.</li>
<li><em>path</em>: This is the path of the plugin in the filesystem. Relative paths are supported, and are relative to the configuration file. This attribute is <b>required</b>.</li>
<li><em>dependencies</em>: This field specifies a list of plugins that must be loaded before this plugin. This plugin will be capable of access plugins listed here. This attribute is <b>optional</b>.</li>
<li><em>customData</em>: It's a field whose value is converted to a QVariant and passed to the plugin. It can be used to pass arbitrary data, like application name or whatever. This attribute is <b>optional</b>.</li>
</ul>
</li>
<li><em>requests</em>: This attribute stores metadata about the requests handled by this object. The value of this field is an array and each element of this array describes a handler and is an object with the following attributes:<ul>
<li><em>path</em>: Defines the regex pattern used to filter requests based on the url's path component. The regex is processed through QRegularExpression. This attribute is <b>required</b> and <b>must</b> be an valid regex.</li>
<li><em>plugin</em>: Defines what plugin is used to handle request matching the rules defined in this containing block. This attribute is <b>required</b>.</li>
<li><em>method</em>: Define what HTTP method is accepted by this handler. This field is <b>optional</b> and, if it's not defined, it won't be used to filter the requests.</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>An empty value isn't acceptable to a field, except for <em>customValue</em> at <em>plugins</em> and <em>path</em> at <em>requests</em> fields. If you use an unacceptable value, Tufão may reject your file.</dd></dl>
<p>An example follows: </p><pre class="fragment">{
    version: 1,
    plugins: [
        {
            name: "home",
            path: "/home/vinipsmaker/Projetos/tufao-project42/build/plugins/libhome.so",
            customData: {appName: "Hello World", root: "/"}
        },
        {
            name: "user",
            path: "show_user.so",
            dependencies: ["home"]
        },
        {
            name: "404",
            path: "/usr/lib/tufao/plugins/notfound.so",
            customData: "&lt;h1&gt;Not Found&lt;/h1&gt;&lt;p&gt;I'm sorry, but it's your fault&lt;/p&gt;"
        }
    ],
    requests: [
        {
            path: "^/$",
            plugin: "home",
            method: "GET"
        },
        {
            path: "^/user/(\w*)$",
            plugin: "user"
        },
        {
            path: "",
            plugin: "404"
        }
    ]
}
</pre><p>The <em>requests</em> attribute is used to seed data to a <a class="el" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router. ">HttpServerRequestRouter</a> object. Because this, you can use features like return false from a handler to allow another handler handle a request.</p>
<dl class="section note"><dt>Note</dt><dd>If the <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> finds an attribute not recognizable, the attribute will be skipped. You can use this to extend the file with customized fields and the <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">HttpPluginServer</a> will continue to behave normally.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>After reload the config, Tufão might recycle some objects to achieve the goal of build a matching request router faster, if dependencies don't change. You can rely on the dependency system for initialization order, but you can't know if the plugins will or not be reloaded after the config changes, because the behaviour is not defined and might change in different Tufão versions.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="class_tufao_1_1_http_plugin_server.html#a4c1c5e33bb60c966bb129d30b137aa8a" title="Returns the path of the last configuration file used. ">config</a> </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="httppluginserver_8h_source.html">httppluginserver.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_tufao.html">Tufao</a></li><li class="navelem"><a class="el" href="class_tufao_1_1_http_plugin_server.html">HttpPluginServer</a></li>
    <li class="footer">Generated on Sun Mar 29 2015 12:14:31 for tufao by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
